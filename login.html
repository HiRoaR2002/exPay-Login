<!DOCTYPE html>
<html>

<head>
  <title>Login</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>

<body>
  <h2>Signing you in...</h2>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDF4NqZN3eum_IDcjoyvA6nAQiwJymb9bw",
      authDomain: "expay-2002.firebaseapp.com",
      projectId: "expay-2002"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then(async (result) => {
        const token = await result.user.getIdToken();

        // Send token back to opener (plugin UI)
        if (window.opener) {
          window.opener.postMessage({
            pluginMessage: {
              type: 'auth-token',
              token: token
            }
          }, '*');
          window.close();
        } else {
          document.body.innerHTML = "No opener found. Please return to the plugin.";
        }
      })
      .catch(error => {
        console.error("Login failed:", error);
        document.body.innerHTML = "Login failed: " + error.message;
      });
  </script>
</body>

</html>